---
- name: Install required packages
  hosts: docker-internal
  become: yes
  tasks:
    - name: Install required packages
      package:
        name:
          - python3
          - python3-pip
          - python3-docker
          - python3-setuptools
        state: present

- name: Deploy media services
  hosts: docker-internal
  become: yes 
  roles:
    - jackett
    - transmission
    - radarr
    - sonarr
    - jellyfin
    - bazarr
    - calibre-web
    - calibre    
    - tdarr
    - headphones

- name: Register DNS names in Mikrotik
  hosts: routeros
  tasks:
    - include_tasks: roles/mikrotik/tasks/add-dns-cname-entry.yml
      vars:
        dns_name: "{{fqdn_service}}"
        dns_cname: "{{vault_docker_host}}"
      loop: "{{ fqdn_services|flatten(levels=1) }}"