###############################################################
#                   Authelia configuration                    #
###############################################################

host: 0.0.0.0
port: 9091
log_level: info
log_file_path: /config/authelia.log
default_redirection_url: "https://{{project_tld}}"

# Time-based One-Time Password
totp:
  issuer: "{{domain_tld}}"
  period: 30
  skew: 1

authentication_backend:
  # file:
  #   path: /config/users_database.yml
  ldap:
    url: "ldap://{{ldap_server_ip}}"
    base_dn: {{base_dn}}
    username_attribute: uid
    start_tls: false
    tls:
      skip_verify: false
    additional_users_dn: cn=users
    users_filter: (&({username_attribute}={input})(objectclass=person))
    groups_filter: (&(objectclass=posixGroup))
    group_name_attribute: cn
    user: uid=root,cn=users,{{base_dn}}
    display_name_attribute: displayName

access_control:
  default_policy: deny
  rules:
    - domain: "login.{{domain_tld}}"
      policy: bypass
    - domain: 
        - "giovanni.{{domain_tld}}"
        - "file.{{domain_tld}}"
        - "share.{{domain_tld}}"
        - "cinema.{{domain_tld}}"
      policy: bypass
    - domain: "vault.{{domain_tld}}"
      policy: bypass
    - domain:
      - "cinema.{{domain_tld}}"
      - "vault.{{domain_tld}}"
      networks:
        - 192.168.0.0/16
      policy: bypass
    - domain: vault.liboni.me
      resources:
        - "^/admin/.*$"
      subject: "group:admins"
      policy: one_factor
    - domain:
        - "*.{{project_tld}}"
      policy: one_factor

session:
  name: authelia_liboni_me
  expiration: 48h # 1 hour
  inactivity: 12h # 5 minutes
  remember_me_duration:  1M
  domain: liboni.me # Should match whatever your root protected domain is
  redis:
    host: redis
    port: 6379

regulation:
  max_retries: 7
  find_time: 120
  ban_time: 1M

storage:
  # local:
  #   path: /config/db.sqlite3
  mysql:
    host: mariadb
    port: 3306
    database: authelia
    username: {{authelia_db_username}}
    # Password can also be set using the env variables AUTHELIA_STORAGE_MYSQL_PASSWORD_FILE
    # password: PASSWORD_GOES_HERE # use docker secret file instead AUTHELIA_STORAGE_MYSQL_PASSWORD_FILE

notifier:
  # filesystem:
  #   filename: /config/notification.txt
  smtp:
    username: {{smtp_user}}
    host: {{smtp_server}}
    sender: {{smtp_sender}}
    port: 587